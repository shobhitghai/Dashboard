/*! Fashion_Dashboard 1.0.0 2015-08-12 */
function getDeviceState(){var a=window.getComputedStyle(document.querySelector(".state-indicator"),":before").getPropertyValue("content");return a=a.replace(/"/g,""),a=a.replace(/'/g,"")}function getInitData(){function a(a){var b=$.parseJSON(a)[0];b&&b.email&&(window.uId=b.email,$(".nav-user-name a").text("Welcome "+b.name),getStoreListData(app.util.initModules,b.email))}function b(a){console.log("userinfo "+a||"err")}$.ajax({url:hostUrl+"getUserInfo",success:function(b){a(b)},error:function(a){b(a)}})}function getStoreListData(a,b){function c(b){var b=$.parseJSON(b),c=[],d=[];window.panelList=b,$.each(b,function(a,b){c.push(this.store_id),d.push(this.brand_id)}),window.filterParamObj.storeId=c,window.brandObj.brandId=d.getUnique(),window.defaultFilterParam=c,a()}function d(a){console.log("navbar"+a||"err")}$(".mod-navbar").find(".store-dropdown");window.storeDetail={name:""},window.filterParamObj={storeId:[],city:[],brandId:[]},window.brandObj={},$.ajax({url:hostUrl+"getStoreDetails",data:{id:b},success:function(a){c(a)},error:function(a){d(a)}})}(function(){this.app={}}).call(this),function(){app.config={hello:"world"}}(app);var indicator=document.createElement("div");indicator.className="state-indicator",document.body.appendChild(indicator),window.hostUrl=window.hostUrl?window.hostUrl:"http://"+window.location.hostname+"/api/",function(){window.console||(window.console={});for(var a=["log","info","warn","error","debug","trace","dir","group","groupCollapsed","groupEnd","time","timeEnd","profile","profileEnd","dirxml","assert","count","markTimeline","timeStamp","clear"],b=function(){},c=0;c<a.length;c++)window.console[a[c]]||(window.console[a[c]]=b)}(),Array.prototype.getUnique=function(){for(var a={},b=[],c=0,d=this.length;d>c;++c)a.hasOwnProperty(this[c])||(b.push(this[c]),a[this[c]]=1);return b},$(function(){getInitData()}),function(){app.util={initModules:function(a){var b=[],c=[],d='[class^="mod-"], [class*=" mod-"]';targets=$(d,a),a=$(a),0===a.length&&(a=$(document)),a.each(function(){$(this).filter(d).length&&(targets=targets.add($(this)))}),targets.each(function(){var a=$(this).prop("class").match(/mod-([^ ]+)/g);$.each(a,function(c){var d=a[c].replace("mod-","");app[d]&&b.push(d)})}),$.each(b,function(a,b){-1===$.inArray(b,c)&&c.push(b)}),b=c;var e=[];return $.each(b,function(c){app[b[c]].init?app[b[c]].settings.defer?e.push(b[c]):app[b[c]].init(a):console.log("initModule: The module '"+b[c]+"' does not have an init method")}),$.each(e,function(b){app[e[b]].init?app[e[b]].init(a):console.log("initModule: The module '"+e[b]+"' does not have an init method")}),b}}}(app),function(){app["ajax-wrapper"]={sendAjax:function(a,b,c,d,e){e&&NProgress.start(!0),$.ajax({url:hostUrl+a,data:b||{},cache:!0,success:function(a){c(a),e&&NProgress.done(!0)},error:function(a){d(a)}})}}}(app),function(){app["filter-panel"]={settings:{target:".mod-filter-panel"},init:function(a){this.settings;app["filter-panel"].fetchData(),app["filter-panel"].selectionHandler()},fetchData:function(a,b,c,d){function e(b){var b=$.parseJSON(b);a?(g.filterSelectionResponse=b,c&&c(g.filterSelectionResponse),g.filterSelectionResponse.length||d.click()):(g.response=b,$(g.settings.target).find(".lbjs").remove(),$(g.settings.target).find(".modal-body select option").remove(),app["filter-panel"].renderList(b,""),app["filter-panel"].filterListSelection())}function f(a){console.log(a)}var g=this;$.ajax({url:hostUrl+"getStoreDetails",data:{id:uId,filterParamObj:b?b:""},success:function(a){e(a)},error:function(a){f(a)}})},renderList:function(a,b){var c=this.settings,d=$(c.target).find("#city-dd"),e=$(c.target).find("#name-dd"),f=$(c.target).find("#brand-dd"),g=new Array,h=new Array,i=new Array;$.each(a,function(a,b){g.push(this.city),h.push(this.name),i.push(this.brand_name)}),g=g.getUnique(),h=h.getUnique(),i=i.getUnique(),"city"!=b&&app["filter-panel"].appendList(g,d,"city","by city"),"name"!=b&&app["filter-panel"].appendList(h,e,"name","by store"),"brand_name"!=b&&app["filter-panel"].appendList(i,f,"brand_name","by brand")},selectionHandler:function(){var a=this,b=this.settings,c=$(b.target);c.find(".btn-filter").on("click",function(){var c=[],d=[],e=[],f=$(b.target).find(".lbjs-item[selected=selected]");if(f.length){$.each(f,function(a,b){"city"==$(this).data("list-type")?c.push($(this).text()):"name"==$(this).data("list-type")?d.push(app["filter-panel"].getStoreId($(this).text())):"brand_name"==$(this).data("list-type")&&e.push(app["filter-panel"].getBrandId($(this).text()))}),window.filterParamObj={storeId:d,city:c,brandId:e};var g=[];$.each(a.filterSelectionResponse,function(a,b){g.push(this.brand_id)}),window.brandObj.brandId=g.getUnique()}else window.filterParamObj.storeId=window.defaultFilterParam;console.log(c,d,e),$.each(app,function(a,b){app[a].refreshData&&app[a].refreshData()})}),c.find(".btn-reset-filter").on("click",function(){c.find(".lbjs").remove(),c.find(".modal-body select option").remove(),app["filter-panel"].renderList(a.response,""),app["filter-panel"].filterListSelection()})},appendList:function(a,b,c,d){$.each(a,function(a,c){b.append("<option>"+c+"</option>")}),b.listbox({searchbar:!0,listType:c,searchText:d})},filterListSelection:function(){var a=this.settings,b=$(a.target);new Array;b.find(".lbjs-item").on("click",function(){var b=[],c=[],d=[],e=$(a.target).find(".lbjs-item[selected=selected]");$.each(e,function(a,e){"city"==$(this).data("list-type")?b.push($(this).text()):"name"==$(this).data("list-type")?c.push(app["filter-panel"].getStoreId($(this).text())):"brand_name"==$(this).data("list-type")&&d.push(app["filter-panel"].getBrandId($(this).text()))});var f={storeId:c,city:b,brandId:d};app["filter-panel"].fetchData(!0,f,app["filter-panel"].bindFilterValue,$(this))})},bindFilterValue:function(a){var b=[],c=[],d=[];$.each(a,function(a,e){b.push(this.name),c.push(this.brand_name),d.push(this.city)}),$(".lbjs-item").addClass("fade-out"),$.each($("div[data-list-type = city]"),function(a,b){d.indexOf($(this).text())>-1?$(this).removeClass("fade-out"):$(this).removeAttr("selected")}),$.each($("div[data-list-type = name]"),function(a,c){b.indexOf($(this).text())>-1?$(this).removeClass("fade-out"):$(this).removeAttr("selected")}),$.each($("div[data-list-type = brand_name]"),function(a,b){c.indexOf($(this).text())>-1?$(this).removeClass("fade-out"):$(this).removeAttr("selected")})},enableDisableListSelection:function(a,b,c){function d(b){$.each($(e.target).find(".lbjs-item[data-list-type ="+b+"]"),function(c,d){var e=this;$(e).attr("disabled",!0),$.each(a,function(a,c){$(e).text()===this[b]?$(e).attr("disabled",!1):($(e).attr("data-selected",!1),$(e).attr("selected",!1))})})}var e=this.settings;a=a.uniqueObjects(["brand_id","brand_name","city","name","store_id"]),console.log(a),"city"==b&&(d("name"),d("brand_name")),"name"==b&&(d("city"),d("brand_name")),"brand_name"==b&&(d("city"),d("name"))},getStoreId:function(a){var b,c=this;return $.each(c.response,function(c,d){return this.name==a?(b=this.store_id,!1):void 0}),b},getBrandId:function(a){var b,c=this;return $.each(c.response,function(c,d){return this.brand_name==a?(b=this.brand_id,!1):void 0}),b}}}(app),function(){app["filter-panel-time-trend"]={settings:{target:".mod-filter-panel-time-trend"},init:function(a){this.settings;app["filter-panel-time-trend"].fetchData(),app["filter-panel-time-trend"].selectionHandler()},fetchData:function(a,b,c,d){function e(b){var b=$.parseJSON(b);a?(g.filterSelectionResponse=b,c&&c(g.filterSelectionResponse),g.filterSelectionResponse.length||d.click()):(g.response=b,$(g.settings.target).find(".lbjs").remove(),$(g.settings.target).find(".modal-body select option").remove(),app["filter-panel-time-trend"].renderList(b,""),app["filter-panel-time-trend"].filterListSelection())}function f(a){console.log(a)}var g=this;$.ajax({url:hostUrl+"getStoreDetails",data:{id:uId,filterParamObj:b?b:""},success:function(a){e(a)},error:function(a){f(a)}})},renderList:function(a,b){var c=this.settings,d=$(c.target).find("#city-dd"),e=$(c.target).find("#name-dd"),f=$(c.target).find("#brand-dd"),g=new Array,h=new Array,i=new Array;$.each(a,function(a,b){g.push(this.city),h.push(this.name),i.push(this.brand_name)}),g=g.getUnique(),h=h.getUnique(),i=i.getUnique(),"city"!=b&&app["filter-panel-time-trend"].appendList(g,d,"city","by city"),"name"!=b&&app["filter-panel-time-trend"].appendList(h,e,"name","by store"),"brand_name"!=b&&app["filter-panel-time-trend"].appendList(i,f,"brand_name","by brand")},selectionHandler:function(){var a=this,b=this.settings,c=$(b.target);c.find(".btn-filter").on("click",function(){var a=[],c=[],d=[],e=$(b.target).find(".lbjs-item[selected=selected]");e.length?($.each(e,function(b,e){"city"==$(this).data("list-type")?a.push($(this).text()):"name"==$(this).data("list-type")?c.push(app["filter-panel-time-trend"].getStoreId($(this).text())):"brand_name"==$(this).data("list-type")&&d.push(app["filter-panel-time-trend"].getBrandId($(this).text()))}),window.filterParamObj={storeId:c,city:a,brandId:d}):window.filterParamObj.storeId=window.defaultFilterParam,app["time-trend"].init(!0)}),c.find(".btn-reset-filter").on("click",function(){c.find(".lbjs").remove(),c.find(".modal-body select option").remove(),app["filter-panel-time-trend"].renderList(a.response,""),app["filter-panel-time-trend"].filterListSelection()})},appendList:function(a,b,c,d){$.each(a,function(a,c){b.append("<option>"+c+"</option>")}),b.listbox({searchbar:!0,listType:c,searchText:d})},filterListSelection:function(){var a=this.settings,b=$(a.target);new Array;b.find(".lbjs-item").on("click",function(){var b=[],c=[],d=[],e=$(a.target).find(".lbjs-item[selected=selected]");$.each(e,function(a,e){"city"==$(this).data("list-type")?b.push($(this).text()):"name"==$(this).data("list-type")?c.push(app["filter-panel-time-trend"].getStoreId($(this).text())):"brand_name"==$(this).data("list-type")&&d.push(app["filter-panel-time-trend"].getBrandId($(this).text()))});var f={storeId:c,city:b,brandId:d};app["filter-panel-time-trend"].fetchData(!0,f,app["filter-panel-time-trend"].bindFilterValue,$(this))})},bindFilterValue:function(a){var b=[],c=[],d=[];$.each(a,function(a,e){b.push(this.name),c.push(this.brand_name),d.push(this.city)}),$(".lbjs-item").addClass("fade-out"),$.each($("div[data-list-type = city]"),function(a,b){d.indexOf($(this).text())>-1?$(this).removeClass("fade-out"):$(this).removeAttr("selected")}),$.each($("div[data-list-type = name]"),function(a,c){b.indexOf($(this).text())>-1?$(this).removeClass("fade-out"):$(this).removeAttr("selected")}),$.each($("div[data-list-type = brand_name]"),function(a,b){c.indexOf($(this).text())>-1?$(this).removeClass("fade-out"):$(this).removeAttr("selected")})},enableDisableListSelection:function(a,b,c){function d(b){$.each($(e.target).find(".lbjs-item[data-list-type ="+b+"]"),function(c,d){var e=this;$(e).attr("disabled",!0),$.each(a,function(a,c){$(e).text()===this[b]?$(e).attr("disabled",!1):($(e).attr("data-selected",!1),$(e).attr("selected",!1))})})}var e=this.settings;a=a.uniqueObjects(["brand_id","brand_name","city","name","store_id"]),console.log(a),"city"==b&&(d("name"),d("brand_name")),"name"==b&&(d("city"),d("brand_name")),"brand_name"==b&&(d("city"),d("name"))},getStoreId:function(a){var b,c=this;return $.each(c.response,function(c,d){return this.name==a?(b=this.store_id,!1):void 0}),b},getBrandId:function(a){var b,c=this;return $.each(c.response,function(c,d){return this.brand_name==a?(b=this.brand_id,!1):void 0}),b}}}(app),function(){app["tile-section"]={settings:{target:".mod-tile-section",metric:{comparison:"Consecutive",period:"Day"},c:0},init:function(a){var b=this;this.triggerNext=!0,this.tile_template=App.Template["tile-opportunity"],this.tile_repeat_cust=App.Template["tile-repeat-cust"];var c=this.settings;c.metric.storeName=window.storeDetail.name,c.metric.filterParamObj=window.filterParamObj,app["tile-section"]._fetchData("getTilesData",c.metric,!0),$(c.target).find(".btn-metric").off().on("click",function(){"Like"==$(this).attr("data-metric-comparison")?($(c.target).find('.grp-timeline .btn-metric[data-metric-period != "Day"]').removeClass("active").addClass("disabled"),$(c.target).find('.grp-timeline .btn-metric[data-metric-period="Day"]').addClass("active")):"Consecutive"==$(this).attr("data-metric-comparison")&&$(c.target).find('.grp-timeline .btn-metric[data-metric-period != "Day"]').removeClass("disabled"),$(this).hasClass("active")||($(this).attr("data-metric-comparison")?c.metric={comparison:$(this).data("metric-comparison").trim(),period:$(".grp-timeline .active").data("metric-period").trim(),storeName:window.storeDetail.name,filterParamObj:window.filterParamObj}:c.metric={comparison:$(".grp-comparison .active").data("metric-comparison").trim(),period:$(this).data("metric-period").trim(),storeName:window.storeDetail.name,filterParamObj:window.filterParamObj},app["tile-section"]._fetchData("getTilesData",c.metric,!0))}),this.ajaxInterval=setInterval(function(){c.metric.storeName=window.storeDetail.name,c.metric.filterParamObj=window.filterParamObj,b.triggerNext&&app["tile-section"]._fetchData("getTilesData",c.metric)},5e3)},refreshData:function(){var a=this;clearInterval(a.ajaxInterval),app["tile-section"].init()},_fetchData:function(a,b,c){function d(a){a.Error?clearInterval(f.ajaxInterval):(f.triggerNext=!0,app["tile-section"]._bindTemplate(a,b))}function e(a){clearInterval(f.ajaxInterval)}var f=this;this.settings;f.triggerNext=!1,app["ajax-wrapper"].sendAjax(a,b,d,e,c)},_bindTemplate:function(a,b){var c=$.parseJSON(a),d=c.opportunityData,e=c.storefrontData,f=c.dwellTimeData,g=c.repeatCustomer;$(".section-opportunity").html(this.tile_template({"tile-name":"Outside Opportunity","tile-percent":d.current||"NA","tile-percent-change":(d.comparison?app["tile-section"]._formatComparisonPercent(d.comparison.toFixed(1)):"NA")+"%","tile-period-param":"vs last "+app["tile-section"]._formatPeriodParam(b)})),$(".section-storeFront").html(this.tile_template({"tile-name":"Storefront Conversion","tile-percent":(e.current?e.current.toFixed(1):"NA")+"%","tile-percent-change":(e.comparison?app["tile-section"]._formatComparisonPercent(e.comparison.toFixed(1)):"NA")+"%","tile-period-param":"vs last "+app["tile-section"]._formatPeriodParam(b)})),$(".section-dwellTime").html(this.tile_template({"tile-name":"Dwell Time (mm:ss)","tile-percent":f.current?app["tile-section"]._formatDwellTime(f.current.toFixed(0)):"NA","tile-percent-change":(f.comparison?app["tile-section"]._formatComparisonPercent(f.comparison.toFixed(1)):"NA")+"%","tile-period-param":"vs last "+app["tile-section"]._formatPeriodParam(b)})),$(".section-customers").html(this.tile_repeat_cust({"tile-name":"Repeat Customers","tile-percent":g.current?g.current.toFixed(1)+"%":"NA","tile-percent-change":(g.comparison?app["tile-section"]._formatComparisonPercent(g.comparison.toFixed(1)):"NA")+"%","tile-period-param":"vs last "+app["tile-section"]._formatPeriodParam(b)}))},_formatPeriodParam:function(a){return"Like"==a.comparison?Date().split(" ")[0]:a.period},_formatComparisonPercent:function(a){return-1==a.indexOf("-")&&(a="+"+a),a},_formatDwellTime:function(a){var b=parseInt(a/60)%60,c=parseInt(a)%60;return(10>b?"0"+b:b)+":"+(10>c?"0"+c:c)}}}(app),function(){app["shopper-engagement"]={settings:{target:".mod-shopper-engagement"},init:function(a){var b=this.settings,c=$(b.target).find("#shopper-engagement-chart");app["shopper-engagement"].fetchData("getShopperEngagement",c)},refreshData:function(){app["shopper-engagement"].init()},fetchData:function(a,b){function c(a){var a=$.parseJSON(a),c={};c.currentData=app["shopper-engagement"].reformatData(a.currentMonthArray),c.pastData=app["shopper-engagement"].reformatData(a.lastMonthMArray),app["shopper-engagement"].renderChart(b,c)}function d(a){console.log("navbar"+a||"err")}app["ajax-wrapper"].sendAjax(a,{filterParamObj:window.filterParamObj},c,d)},reformatData:function(a){var b=a[0]+a[1]+a[2]+a[3],c=[];return $.each(a,function(a,d){c.push(Math.round(d/b*100))}),c},renderChart:function(a,b){a.highcharts({chart:{type:"bar",style:{fontFamily:"Arial"},height:400},colors:["#a6a6a6","#55c6f2"],title:{text:""},xAxis:{categories:[">10 mins","5-10 mins","2-5 mins","bounced"],title:{text:null}},yAxis:{min:0,title:{text:""},lineWidth:0,minorGridLineWidth:0,lineColor:"transparent",gridLineColor:"transparent",labels:{enabled:!1}},tooltip:{valueSuffix:" %"},plotOptions:{bar:{dataLabels:{enabled:!0,format:"{y}%"}}},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",margin:30},credits:{enabled:!1},series:[{name:"Last Month",data:b.pastData},{name:"This Month",data:b.currentData}]})}}}(app),function(){app["shopper-profile"]={settings:{target:".mod-shopper-profile"},init:function(a){var b=this.settings,c=$(b.target).find("#shopper-profile-chart");app["shopper-profile"].fetchData("getShopperProfile",c)},refreshData:function(){app["shopper-profile"].init()},fetchData:function(a,b){function c(a){var a=$.parseJSON(a),c=new Array,d=["Others",0];$.each(a,function(b,e){if(5>b){var f=new Array;f.push(this.s_profile),f.push(Math.round(this["count(distinct(tv.mac_address))"])),c.push(f)}else d[1]=d[1]+Math.round(this["count(distinct(tv.mac_address))"]),b==a.length-1&&c.push(d)}),app["shopper-profile"].renderChart(b,c)}function d(a){console.log("navbar"+a||"err")}app["ajax-wrapper"].sendAjax(a,{storeName:window.storeDetail.name,filterParamObj:window.filterParamObj},c,d)},renderChart:function(a,b){a.highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,style:{fontFamily:"Arial"},height:366},colors:["#55c6f2","#a9d18e","#f7d348","#c9c9c9","#b4c7e7","#767171"],title:{text:""},tooltip:{pointFormat:"<b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1},showInLegend:!0},series:{dataLabels:{enabled:!0,formatter:function(){return Math.round(this.percentage)+"%"},distance:-30,color:"white"}}},legend:{itemMarginBottom:10},series:[{type:"pie",data:b}],credits:{enabled:!1}})}}}(app),function(){app["revisit-frequency"]={settings:{target:".mod-revisit-frequency"},init:function(a){var b=this.settings,c=$(b.target).find("#revisit-frequency-chart");app["revisit-frequency"].fetchData("getRevisitFrequency",c)},refreshData:function(){app["revisit-frequency"].init()},fetchData:function(a,b){function c(a){var a=$.parseJSON(a),c=new Array;$.each(a,function(a,b){var d=new Array;d.push(this.category),d.push(this["COUNT(mac_address)"]),c.push(d)}),app["revisit-frequency"].renderChart(b,c)}function d(a){console.log("navbar"+a||"err")}app["ajax-wrapper"].sendAjax(a,{storeName:window.storeDetail.name,filterParamObj:window.filterParamObj},c,d)},renderChart:function(a,b){a.highcharts({chart:{type:"pie",style:{fontFamily:"Arial"}},colors:["#b4c7e7","#0070c0","#a9d18e","#55c6f2","#f7d348","#767171"],title:{text:""},yAxis:{title:{text:"Total percent market share"}},plotOptions:{pie:{shadow:!1},series:{dataLabels:{enabled:!0,formatter:function(){return"test"},distance:-30,color:"white"}}},tooltip:{formatter:function(){return"<b>"+this.point.name+"</b>: "+this.y}},legend:{enabled:!0,layout:"vertical",align:"right",width:200,verticalAlign:"middle",useHTML:!0,itemMarginTop:10,itemMarginBottom:10,labelFormatter:function(){return'<div style="text-align: left; width:50px;float:right;">'+this.name+"</div>"}},series:[{name:"Revisit Freq.",data:b,size:"100%",innerSize:"60%",showInLegend:!0,dataLabels:{enabled:!1}}],credits:{enabled:!1}})}}}(app),function(){app["cross-store"]={settings:{target:".mod-cross-store"},init:function(a){var b=this.settings,c=$(b.target).find("#cross-store-chart");app["cross-store"].fetchData("getCrossVisitData",c)},refreshData:function(){app["cross-store"].init()},fetchData:function(a,b){function c(a){var a=$.parseJSON(a);a=a.crossVisit;var c=[{y:0,color:"#a9d18e"},{y:0,color:"#55c6f2"}];console.log(a),$.each(a,function(a,b){"store"==a?c[0].y=b:c[1].y=b}),app["cross-store"].renderChart(b,c)}function d(a){console.log("navbar"+a||"err")}app["ajax-wrapper"].sendAjax(a,{filterParamObj:window.filterParamObj,brandObj:window.brandObj},c,d)},renderChart:function(a,b){a.highcharts({chart:{type:"column",style:{fontFamily:"Arial"}},title:{text:""},xAxis:{categories:["Selected Store(s)","Brand Average"],crosshair:!0},yAxis:{title:{text:"% (cross store visits to total visits)"}},legend:{reversed:!0,enabled:!1},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="padding:0"><b>{point.y:.2f}%</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Cross-store",data:b}],credits:{enabled:!1}})}}}(app),function(){app["time-trend"]={settings:{target:".mod-time-trend"},init:function(a){var b=this.settings;this.chartContainer=$(b.target).find("#time-trend-chart"),this.response=null,app["time-trend"].fetchData("getMonthlyTimeTrendData",this.chartContainer),this.metricSelectionHandler()},refreshData:function(){app["time-trend"].init()},fetchData:function(a,b){function c(a){var a=$.parseJSON(a);console.log("from time trend"),console.log(a),e.response=a;var c=app["time-trend"].buildOpportunityObj(a);app["time-trend"].renderChart(b,c)}function d(a){console.log("navbar"+a||"err")}var e=this;app["ajax-wrapper"].sendAjax(a,{filterParamObj:window.filterParamObj,sectionParamObj:window.trendSectionObj},c,d,!0)},metricSelectionHandler:function(){var a=this,b=$(this.settings.target);b.find(".btn-metric").on("click",function(){a.response&&("Opportunities"==$(this).attr("data-trend-type")?app["time-trend"].renderChart(a.chartContainer,app["time-trend"].buildOpportunityObj(a.response)):"StoreFront"==$(this).attr("data-trend-type")?app["time-trend"].renderChart(a.chartContainer,app["time-trend"].buildStoreFrontObj(a.response)):"DwellTime"==$(this).attr("data-trend-type")?app["time-trend"].renderChart(a.chartContainer,app["time-trend"].buildDwellTimeObj(a.response)):"RepeatCustomer"==$(this).attr("data-trend-type")&&app["time-trend"].renderChart(a.chartContainer,app["time-trend"].buildRepeatCustObj(a.response)))})},buildOpportunityObj:function(a){var b={globalArr:[],sectionArr:[],periodArr:[]};return $.each(a.filterPanelData.opportunityData,function(a,c){b.periodArr.push(this.period),b.globalArr.push(this.data)}),a.sectionPanelData.opportunityData&&$.each(a.sectionPanelData.opportunityData,function(a,c){b.sectionArr.push(this.data)}),b},buildStoreFrontObj:function(a){var b={globalArr:[],sectionArr:[],periodArr:[]};return $.each(a.filterPanelData.storeFrontData,function(c,d){b.periodArr.push(this.period),a.filterPanelData.opportunityData[c]&&b.globalArr.push(this.data/a.filterPanelData.opportunityData[c].data*100)}),a.sectionPanelData.storeFrontData&&$.each(a.sectionPanelData.storeFrontData,function(c,d){a.sectionPanelData.opportunityData[c]&&b.sectionArr.push(this.data/a.sectionPanelData.opportunityData[c].data*100)}),b},buildDwellTimeObj:function(a){var b={globalArr:[],sectionArr:[],periodArr:[]};return $.each(a.filterPanelData.dwellTimeData,function(a,c){b.periodArr.push(this.period),b.globalArr.push(this.data)}),a.sectionPanelData.dwellTimeData&&$.each(a.sectionPanelData.dwellTimeData,function(a,c){b.sectionArr.push(this.data)}),b},buildRepeatCustObj:function(a){var b={globalArr:[],sectionArr:[],periodArr:[]};return $.each(a.filterPanelData.repeatCustData,function(c,d){b.periodArr.push(this.period),a.filterPanelData.storeFrontData[c]&&b.globalArr.push(this.data/a.filterPanelData.storeFrontData[c].data*100)}),a.sectionPanelData.dwellTimeData&&$.each(a.sectionPanelData.repeatCustData,function(c,d){a.sectionPanelData.storeFrontData[c]&&b.sectionArr.push(this.data/a.sectionPanelData.storeFrontData[c].data*100)}),b},renderChart:function(a,b){a.highcharts({title:{text:"",style:{fontFamily:"Arial"}},xAxis:{categories:b.periodArr},yAxis:{title:{text:"Count"},plotLines:[{value:0,width:1,color:"#808080"}]},tooltip:{valueSuffix:"",valueDecimals:2},legend:{layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0},series:[{name:"Global Selection",data:b.globalArr},{name:"Specific Selection",data:b.sectionArr}],credits:{enabled:!1}})}}}(app),function(){app["right-now"]={settings:{target:".mod-right-now"},init:function(a){var b=this;this.triggerNext=!0;var c=this.settings,d=$(c.target).find("#shoppers-mall-chart"),e=$(c.target).find("#shoppers-store-chart");app["right-now"].fetchData("getRightNowData"),this.refreshInterval=setInterval(function(){b.triggerNext&&app["right-now"].fetchData("getRightNowData")},5e3);var f=[{name:"Discount Sensitive",data:[5]},{name:"Utility Buyer",data:[2]},{name:"Fashion",data:[3]}],g=[{name:"Discount Sensitive",data:[2]},{name:"Utility Buyer",data:[5]},{name:"Fashion",data:[3]}];app["right-now"].renderChart(d,f),app["right-now"].renderChart(e,g)},refreshData:function(){var a=this;clearInterval(a.refreshInterval),app["right-now"].init()},fetchData:function(a){function b(a){if(a.Error)clearInterval(d.refreshInterval);else{d.triggerNext=!0;var a=$.parseJSON(a),b={};a.length&&a[0]&&a[1]&&(b.peopleMall=a[0].cnt+a[1].cnt,b.peopleStore=a[1].cnt,b.conv=100*(b.peopleStore/b.peopleMall).toFixed(2)+"%",$(d.settings.target).find(".people-mall-count").text(b.conv),$(d.settings.target).find(".people-store-count").text(b.peopleStore),$(d.settings.target).find(".people-sales-count").text(Math.ceil(b.peopleStore/4)))}}function c(a){console.log("right-now"+a||"err")}var d=this;d.triggerNext=!1,app["ajax-wrapper"].sendAjax(a,{storeName:window.storeDetail.name,filterParamObj:window.filterParamObj},b,c)},renderChart:function(a,b){a.highcharts({chart:{type:"bar",height:100},colors:["#f7d348","#55c6f2","#a9d18e"],title:{text:""},xAxis:{lineWidth:0,minorGridLineWidth:0,lineColor:"transparent",labels:{enabled:!1},minorTickLength:0,tickLength:0},yAxis:{lineWidth:0,minorGridLineWidth:0,lineColor:"transparent",gridLineColor:"transparent",labels:{enabled:!1},title:{text:""},minorTickLength:0,tickLength:0},legend:{reversed:!0,enabled:!1},plotOptions:{series:{stacking:"normal",pointWidth:50}},series:b,credits:{enabled:!1}})}}}(app),function(){app["internal-benchmarking"]={settings:{target:".mod-internal-benchmarking"},init:function(a){var b=this.settings;$(".benchmark-start-date").datepicker({}),$(".benchmark-end-date").datepicker({});var c=$(b.target).find("#walkins-chart");storeFront_chart=$(b.target).find("#storeFront-chart"),engagement_chart=$(b.target).find("#engagement-chart"),dwell_chart=$(b.target).find("#dwell-chart"),repeatCustomers_chart=$(b.target).find("#repeatCustomers-chart"),topCustomers_chart=$(b.target).find("#topCustomers-chart"),categoriesArr=["Your Store","This Mall/Area","Stores(same city tier)","Stores(All)"];var d={labelName:"Walk-ins",chartbaseMargin:20,containerName:c,dataArr:[{name:"Last Month",data:[107,31,635,203]}],colors:["#00b0f0"]},e={labelName:"Storefront conversion",chartbaseMargin:5,containerName:storeFront_chart,dataArr:[{name:"Last Month",data:[17,341,211,343]}],colors:["#f7d348"]},f={labelName:"Engagement levels",chartbaseMargin:5,containerName:engagement_chart,dataArr:[{name:"Last Month",data:[99,77,665,63]}],colors:["#92d050"]},g={labelName:"Dwell time",chartbaseMargin:20,containerName:dwell_chart,dataArr:[{name:"Last Month",data:[107,31,635,203]}],colors:["#0070c0"]},h={labelName:"Repeat customers",chartbaseMargin:5,containerName:repeatCustomers_chart,dataArr:[{name:"Last Month",data:[107,31,635,203]}],colors:["#ff6d60"]},i={labelName:"Top customers",chartbaseMargin:5,containerName:topCustomers_chart,dataArr:[{name:"Last Month",data:[107,31,635,203]}],colors:["#7030a0"]};app["internal-benchmarking"].renderChart(d),categoriesArr,app["internal-benchmarking"].renderChart(e,categoriesArr),app["internal-benchmarking"].renderChart(f,categoriesArr),app["internal-benchmarking"].renderChart(g,categoriesArr),app["internal-benchmarking"].renderChart(h,categoriesArr),app["internal-benchmarking"].renderChart(i,categoriesArr)},refreshData:function(){app["internal-benchmarking"].init()},renderChart:function(a){var b=a.containerName;b.highcharts({chart:{type:"bar",style:{fontFamily:"Arial",fontSize:"12px"}},colors:a.colors,title:{text:a.labelName,align:"left",x:0,y:10,margin:a.chartbaseMargin},xAxis:{categories:categoriesArr,lineWidth:0,minorGridLineWidth:0,lineColor:"transparent",labels:{enabled:!1},minorTickLength:0,tickLength:0},yAxis:{lineWidth:0,minorGridLineWidth:0,lineColor:"transparent",gridLineColor:"transparent",labels:{enabled:!1},title:{text:""},minorTickLength:0,tickLength:0},tooltip:{valueSuffix:" millions"},plotOptions:{bar:{dataLabels:{enabled:!0}}},legend:{enabled:!1},credits:{enabled:!1},series:a.dataArr})}}}(app),function(){app["campaign-impact"]={settings:{target:".mod-campaign-impact"},init:function(a){var b=this.settings,c=$(b.target),d=c.find(".edit-btn"),e=c.find(".impact-edit"),f=c.find(".campaign-start-date input"),g=c.find(".campaign-end-date input"),h={};e.addClass("edit-active"),$(".campaign-start-date").datepicker({format:"yyyy-mm-dd"}),$(".campaign-end-date").datepicker({format:"yyyy-mm-dd"}),$(b.target).find(".config-save").off("click").on("click",function(){f.val()&&g.val()&&(h.sDate="'"+f.val()+"'",h.eDate="'"+g.val()+"'",h.filterParamObj=window.filterParamObj,app["campaign-impact"].fetchData("getCampaignImpact",h),e.toggleClass("edit-active"))}),d.off("click").on("click",function(){e.toggleClass("edit-active")}),$(b.target).find(".config-cancel").off("click").on("click",function(){e.toggleClass("edit-active")})},refreshData:function(){app["campaign-impact"].init()},saveForm:function(){},fetchData:function(a,b){function c(a){var b=$.parseJSON(a);console.log("res from camp impact"),console.log(b);var c=b.campaignData.cnt/b.campaignData.DiffDate,d=b.lastMonthData.cnt/b.lastMonthData.DiffDate,f=Math.round((c-d)/d*100),g=b.campaignData.dwt,h=b.lastMonthData.dwt,i=Math.round((g-h)/h*100),j=b.newWalkinData,k=j.current.cnt/j.current.DiffDate,l=j.comparison.cnt/j.comparison.DiffDate,m=Math.round((k-l)/l*100);$("#campaign-walkin span").text(e.formatConversionData(f)+"%"),$("#campaign-dwt span").text(e.formatConversionData(i)+"%"),$("#campaing-new-walkin span").text(e.formatConversionData(m)+"%"),e.formatImpactChangeColor()}function d(a){console.log(a||"err")}var e=this;app["ajax-wrapper"].sendAjax(a,b,c,d)},formatConversionData:function(a){return parseInt(a)>=0?"+"+a:a||"NA"},formatImpactChangeColor:function(){var a=$(".mod-campaign-impact .impact-change");$.each(a,function(a,b){parseFloat($(this).find("span").text())>=0?$(this).addClass("impact-pos"):$(this).addClass("impact-neg")})}}}(app),function(){app["modification-impact"]={settings:{target:".mod-modification-impact"},init:function(a){var b=this.settings,c=$(b.target),d=c.find(".edit-btn"),e=c.find(".impact-edit"),f=c.find(".storefront-start-date input"),g={};e.addClass("edit-active"),$(b.target).find(".config-save").off("click").on("click",function(){f.val()&&(g.sDate="'"+f.val()+"'",g.filterParamObj=window.filterParamObj,app["modification-impact"].fetchData("getStoreFrontChange",g),e.toggleClass("edit-active"))}),d.off("click").on("click",function(){e.toggleClass("edit-active")}),$(".storefront-start-date").datepicker({format:"yyyy-mm-dd"})},refreshData:function(){app["modification-impact"].init()},fetchData:function(a,b){function c(a){var b=$.parseJSON(a);console.log(b),$("#sf-conversion-change span").text(e.formatConversionData(b.conversionChange)+"%"),$("#sf-walk-in span").text(e.formatConversionData(b.walkIn)+"%"),$("#sf-dwell-time span").text(e.formatConversionData(b.dwellTime)+"%"),e.formatImpactChangeColor()}function d(a){console.log(a||"err")}var e=this;app["ajax-wrapper"].sendAjax(a,b,c,d)},formatConversionData:function(a){return parseFloat(a)>=0?"+"+a:a||"NA"},formatImpactChangeColor:function(){var a=$(".mod-modification-impact .impact-change");$.each(a,function(a,b){parseFloat($(this).find("span").text())>=0?$(this).addClass("impact-pos"):$(this).addClass("impact-neg");
})}}}(app),function(){app["hour-optimization"]={settings:{target:".mod-hour-optimization"},init:function(a){var b=this.settings,c=$(b.target).find("#hour-optimization-chart");app["hour-optimization"].fetchData("getHourOptimizationData",c)},refreshData:function(){app["hour-optimization"].init()},fetchData:function(a,b){function c(a){var a=$.parseJSON(a),c=new Array,d=new Array;console.log(a),$.each(a,function(a,b){c.push(Math.round(this.avg_walk_by)),d.push(this.hour)}),app["hour-optimization"].renderChart(b,c,d)}function d(a){console.log("navbar"+a||"err")}app["ajax-wrapper"].sendAjax(a,{storeName:window.storeDetail.name,filterParamObj:window.filterParamObj},c,d)},renderChart:function(a,b,c){a.highcharts({chart:{type:"column",style:{fontFamily:"Arial"}},title:{text:""},xAxis:{categories:c,crosshair:!0,title:{text:null}},yAxis:{title:{text:null},lineWidth:0,minorGridLineWidth:0,lineColor:"transparent",gridLineColor:"transparent"},tooltip:{enabled:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0,dataLabels:{enabled:!0,format:"{y}"}}},series:[{name:"Outside opportunity",data:b}],credits:{enabled:!1}})}}}(app);